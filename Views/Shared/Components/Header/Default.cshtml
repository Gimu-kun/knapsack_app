@model knapsack_app.Models.UserModel

<header class="bg-white border-b border-gray-100 shadow-sm fixed top-0 left-0 right-0 z-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-16">
        <a href="/" class="sprung-logo tracking-widest flex items-center">
            Knapsack<span class="ml-1 text-base text-gray-500 font-normal tracking-normal">Thief</span>
        </a>
        
        <nav class="hidden md:flex space-x-6 text-sm font-semibold uppercase tracking-wider">
            <a href="/" class="text-gray-600 hover:text-gray-900 transition duration-150">
                Trang chủ
            </a>
            <a href="/selection" class="text-gray-600 hover:text-gray-900 transition duration-150 flex items-center">
                Thử thách
            </a>
            <a href="/rank?players=3&difficulty=1" class="text-gray-600 hover:text-gray-900 transition duration-150">
                Bảng xếp hạng
            </a>
        </nav>
        
        <div class="flex items-center space-x-4">
            @if (Model == null)
            {
                <a href="/register" class="hidden sm:inline-flex text-gray-600 hover:text-gray-900">Đăng ký</a>
                <a href="/login" class="hidden sm:inline-flex text-gray-600 hover:text-gray-900">Đăng nhập</a>
            }
            else
            {
                <div class="flex items-center space-x-3">
                    <a href="/profile" class="flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition duration-150">
                        @if (!string.IsNullOrEmpty(Model.Avatar))
                        {
                            <img class="h-8 w-8 rounded-full object-cover" src="@Model.Avatar" alt="Avatar" />
                        }
                        else
                        {
                            <div class="h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-500 font-bold text-xs">
                                @(Model.Account.Substring(0, 1).ToUpper())
                            </div>
                        }
                    </a>

                    <button type="button"
                            id="openLogoutModal"
                            class="text-gray-600 hover:text-gray-900 transition duration-150">
                        Đăng xuất
                    </button>
                </div>
            }
        </div>
    </div>
</header>

<div id="logoutModal"
     class="hidden fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-6 shadow-lg w-80 text-center">
        <h2 class="text-lg font-semibold mb-2 text-gray-800">Xác nhận đăng xuất</h2>
        <p class="text-gray-600 mb-4">Bạn có chắc chắn muốn đăng xuất không?</p>

        <div class="flex justify-center space-x-4">
            <button id="cancelLogout"
                    class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 transition">
                Hủy
            </button>
            <form method="post" asp-page="/Cli/Logout">
                <button type="submit" onclick="logout('@Model?.Id')"
                        class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                    Đăng xuất
                </button>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const modal = document.getElementById("logoutModal");
        const openBtn = document.getElementById("openLogoutModal");
        const cancelBtn = document.getElementById("cancelLogout");

        openBtn?.addEventListener("click", () => {
            modal.classList.remove("hidden");
        });

        cancelBtn?.addEventListener("click", () => {
            modal.classList.add("hidden");
        });

        modal.addEventListener("click", (e) => {
            if (e.target === modal) {
                modal.classList.add("hidden");
            }
        });
    });

    function logout(userId) {
        fetch(`/api/user/session_log/logout/${userId}`)
            .then(() => {
                console.log("Logout logged!");
                localStorage.removeItem("token");
                window.location.href = "/login";
            })
            .catch(err => console.error("Logout log error:", err));
    }
</script>
